dex:
  enabled: true

server:
  replicas: 1
  extraArgs:
    - --insecure
  ingress:
    enabled: true
    ingressClassName: "nginx"
    hostname: argocd.internal.devopslab.pagopa.it
    annotations:
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      nginx.ingress.kubernetes.io/backend-protocol: "HTTP"
    tls: false # Cambiato a false per evitare il TLS host doppio
    extraTls:
      - hosts:
          - argocd.internal.devopslab.pagopa.it
        secretName: argocd-internal-devopslab-pagopa-it

redis-ha:
  enabled: false

repoServer:
  replicas: 1

applicationSet:
  replicas: 1

configs:
  params:
    application.namespaces: "${join(",", argocd_application_namespaces)}"

  cm:
    timeout.reconciliation: 31s
    application.resourceTrackingMethod: annotation

  rbac:
    policy.csv: |
      p, role:readonly, applications, get, */*, allow
      p, role:readonly, projects, get, *, allow
      p, role:admin, applications, create, */*, allow
      p, role:admin, applications, update, */*, allow
      p, role:admin, applications, delete, */*, allow
      p, role:admin, applications, sync, */*, allow
      p, role:admin, applications, override, */*, allow
      p, role:admin, applications, action/*, */*, allow
      p, role:admin, projects, create, *, allow
      p, role:admin, projects, update, *, allow
      p, role:admin, projects, delete, *, allow

controller:
  args:
    - --application-namespaces=${join(",", argocd_application_namespaces)}

  clusterRoleRules:
    enabled: true
    rules:
     - apiGroups: ["*"]
       resources: ["*"]
       verbs: ["*"]
       namespaces: "[${join(", ", argocd_application_namespaces)}]"
